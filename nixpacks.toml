# Standard Nixpacks configuration for EVE Go service: workflowstorageservice
# Ensures consistent, optimized builds across all services

[phases.setup]
nixPkgs = ["go_1_23"]

[phases.install]
cmds = ["go mod download"]

[phases.build]
cmds = [
  # Build static binary with optimizations
  # CGO_ENABLED=0: Create static binary (no C dependencies)
  # -ldflags '-w -s': Strip debug info and symbol table (smaller binary)
  # -trimpath: Remove file system paths from binary (reproducible builds)
  "CGO_ENABLED=0 go build -ldflags '-w -s' -trimpath -o workflowstorageservice ./cmd/*"
]

[start]
cmd = "./workflowstorageservice"
